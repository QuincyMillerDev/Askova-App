graph LR
    subgraph Client Browser
        direction TB
        C_UI[React Components] --> C_Hooks[Hooks useCreateQuiz, useSendMsg, useUserSync]
        C_Hooks --> C_Services[Local Services QuizService, ChatMessageService]
        C_Services --> C_Repos[Dexie Repositories]
        C_Repos -- CRUD --> C_Dexie[Dexie / IndexedDB]
    end

    subgraph Server
        direction TB
        S_Sync[SyncService syncService.ts] --> S_TRPCClient[tRPC Service Client]
        S_TRPCClient --> S_Routers[tRPC Routers Quiz, ChatMessage]
        S_Routers --> S_Prisma[Prisma Client]
        S_Prisma -- CRUD --> S_Postgres[PostgreSQL]
    end

%% Local Operations
    C_UI -- Initiates Local Save --> C_Hooks

%% Sync Trigger
    C_Hooks -- Triggers Sync e.g., on Login/Manual --> S_Sync

%% Sync Logic Conceptual Flow
    S_Sync -- Reads Local Data --> C_Repos
    S_Sync -- Fetches Remote Data --> S_TRPCClient
    S_Sync -- Uploads Local-Only Data --> S_TRPCClient
    S_Sync -- Updates Local DB with Remote --> C_Repos

    style C_Dexie fill:#fcc,stroke:#333,stroke-width:2px
    style S_Postgres fill:#fcc,stroke:#333,stroke-width:2px
